<html>
%= include 'bootstrap/header'
<body id="page-top" data-spy="scroll" data-target=".fixed-top" role="document" ng-app="ravada.app">
<div id="wrapper">
    %= include 'bootstrap/navigation'
<div id="page-wrapper" ng-controller="usersPage" ng-init="list_user_groups(<%= $user->id %>)">

    <div class="page-header">
        <div class="card">
             <div class="card-header">
                 <h2><%=l 'User' %>&nbsp;<%= $user->name %>
%               if ( $user->external_auth ) {
                    (<%= $user->external_auth %>)
%               }
                </h2>
             </div> <!-- del panel heading-->
        </div>
        <ul class="nav nav-tabs" id="myTab" role="tablist">
% if ( $_user->is_admin ) {
            <li class="nav-item">
                <a class="nav-link active" href="#admin" role="tab" data-toggle="tab" aria-controls="admin" aria-selected="true">Admin</a>
            </li>
% }
% if ( $_user->can_grant) {
            <li class="nav-item">
                <a class="nav-link" href="#grants" role="tab" data-toggle="tab" aria-controls="grants" aria-selected="true">Grants</a>
            </li>
% }
% if (( $_user->is_admin ) && (! $user->is_external)) {
            <li class="nav-item">
                <a class="nav-link" href="#password" role="tab" data-toggle="tab" aria-controls="password" aria-selected="true">Password</a>
            </li>
% }
% if ( $_user->is_admin && $user->is_external && $user->external_auth eq 'ldap' && $user->ldap_entry ) {
            <li class="nav-item">
                <a class="nav-link" href="#groups" role="tab" data-toggle="tab" aria-controls="groups" aria-selected="true">Groups</a>
            </li>
% }

        </ul>
% if ( $_user->is_admin && $user->is_external && $user->external_auth eq 'ldap' && !$user->ldap_entry ) {
    <div class="alert alert-danger">
    <%=l 'Error: the LDAP entry for this user has been removed.' %>
    </div>
% }
        <div class="tab-content" id="myTabContent">
% if ( $_user->is_admin ) {
            <div class="tab-pane fade show active" id="admin" role="tabpanel" aria-labelledby="admin-tab">
                %= include '/main/manage_user_admin'
            </div>
% }
% if ( $_user->can_grant) {
            <div class="tab-pane fade" id="grants" role="tabpanel" aria-labelledby="grants-tab">
                %= include '/main/manage_user_grants'
            </div>
% }
% if (( $_user->is_admin ) && (! $user->is_external)) {
            <div class="tab-pane fade" id="password" role="tabpanel" aria-labelledby="password-tab">
                %= include '/main/manage_user_password'
            </div>
% }
% if ( $_user->is_admin && $user->is_external && $user->external_auth eq 'ldap' && $user->ldap_entry ) {
            <div class="tab-pane fade" id="groups" role="tabpanel" aria-labelledby="group-tab">
                %= include '/main/manage_user_groups'
            </div>
% }
        </div>
    </div><! --page-header -->
</div>

</div>

    %= include 'bootstrap/scripts'
    %= include 'bootstrap/messages'
</body>
</html>
